<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="/css/app.css">
<style>

  body {
    margin: 0 auto;
    padding: 2rem;
  }
</style>

<script type="module">
  // import 'https://cdn.jsdelivr.net/npm/@hotwired/turbo@8.0.20/+esm'

  // @ts-expect-error
  import { morph } from "https://www.unpkg.com/morphlex@1.0.1/dist/morphlex.min.js"

  // import "https://cdn.jsdelivr.net/npm/@virtualstate/navigation@1.0.1-alpha.212/esnext/polyfill.js/+esm"
  import { DriveShaft } from "/exports/driveshaft.js"
  const driveShaft = new DriveShaft()
  //   driveShaft.replaceStrategy = (newDOM) => {
  //   // upgrade custom elements
  //   const newBody = document.adoptNode(newDOM.body)
  //   morph(document.head, newDOM.head)
  //   morph(document.body, newBody)
  //   driveShaft.syncAttributes(document.documentElement, newDOM.documentElement)
  // }
  driveShaft.start()
  window.driveShaft = driveShaft
</script>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@awesome.me/webawesome@3.0.0/dist-cdn/styles/webawesome.css">
<script type="module" src="https://cdn.jsdelivr.net/npm/@awesome.me/webawesome@3.0.0/dist-cdn/webawesome.loader.js"></script>

<script type="module">
  let socket = null
  function connect () {
    socket = new WebSocket("ws://localhost:8080");

    socket.addEventListener("open", () => {
      console.log("Live reload connected")
    })

    socket.addEventListener("close", () => {
      console.log("Websocket connection closed or unable to connect; " +
        "starting reconnect timeout");

      // Allow the last socket to be cleaned up.
      socket = null;

      // Set an interval to continue trying to reconnect
      // periodically until we succeed.
      setTimeout(function() {
        connect();
      }, 500)
    })
    socket.addEventListener('message', (msg) => {
      if (msg.data === "reload") {
        socket.close(1000, "Reloading page");
        window.location.reload(true)
      }
    });
  }

  connect()
</script>
